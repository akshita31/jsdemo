<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="noindex" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <script src="http://localhost:4242/api/trydotnet.min.js"></script>
    <link rel="stylesheet" type="text/css" href="http://localhost:27261/css/xterm.css" />
</head>

<body>

    <iframe id="editor" data-trydotnet-editor-id="defaultEditor"></iframe>

    </br>
    <button data-trydotnet-mode="run" data-trydotnet-session-id="a">Run</button>
    </br>
    <div data-trydotnet-mode="runResult" data-trydotnet-session-id="a"></div>
    </br>
    <div>
        <pre style="border: none" height="300px" width="800px">
            <code id="trydotnet-content-area">using System;
        using System.Collections.Generic;
        using System.Linq;
        
        namespace SimpleProgram {
            public class Program {
                public static void Main(string[] args)
                {
                    Console.WriteLine("This should be copied to editor when run button is clicked");
                }
            }
        }
        </code>
        </pre>
    </div>
    <button id="trydotnet-copy-button">Copy to editor</button>

    <script nonce="ierS+6bwK9lQgKn5u/nMePHeAoxur+28rgMWrqumVHw=">
        setUpTryDotnet();

        async function setUpTryDotnet() {
            let session = await createTryDotnetSession();
            let openedDocument = await session.openDocument({ fileName: "Program.cs", content: `Console.WriteLine("The power of open document")`, region: "myRegion" });
            let copyTextButton = document.getElementById("trydotnet-copy-button");
            copyTextButton.addEventListener("click", event => setDocumentContent(openedDocument));
        }

        function setDocumentContent(document) {
            //read the content that is present in the window and set the content of the editor
            let contentArea = document.getElementById('trydotnet-content-area');
            document.setContent(contentArea.innerText);
        }

        async function createTryDotnetSession() {
            let configuration = {
                hostOrigin: "http://localhost:58737",
                trydotnetOrigin: "http://localhost:27261",
                useWasmRunner: true
            };

            let project = await trydotnet.createProject({
                packageName :"blazor-console",
                files:[
                        {
                            name: "Program.cs",
                            content:
                                `using System;

namespace fullPaths
{
    class Program
    {
        static void Main(string[] args)
        {
            #region myRegion
            Console.WriteLine("Hello World!");
            #endregion
        }
    }
}`
                        }
                    ]
                    });

            let editors = [document.getElementById("editor")];
            return trydotnet.createSessionWithProjectAndOpenDocument(configuration, editors, window, project, "default.cs");
        }

    </script>
</body>

</html>